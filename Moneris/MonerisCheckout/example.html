BR

this is the request: {"store_id":"moneris","api_token":"hurgle","checkout_id":"A821neris","integrator":"cr_dev","txn_total":"1000.00","environment":"qa","action":"preload","order_no":"","cust_id":"chkt - cust - 0115","dynamic_descriptor":"dyndesc","cart":{"items":[{"url":"https:\/\/esqa.moneris.com\/cr\/checkout\/item1.jpg","description":"One item","product_code":"one_item","unit_cost":"$100.00","quantity":"1"},{"url":"https:\/\/esqa.moneris.com\/cr\/checkout\/item2.jpg","description":"Two item","product_code":"two_item","unit_cost":"$200.00","quantity":"1"},{"url":"https:\/\/esqa.moneris.com\/cr\/checkout\/item3.jpg","description":"Three item","product_code":"two_item","unit_cost":"$100.00","quantity":"1"},{"url":"https:\/\/esqa.moneris.com\/cr\/checkout\/item2.jpg","description":"Four item","product_code":"two_item","unit_cost":"$148.00","quantity":"4"}],"subtotal":"$986.00","tax":{"amount":"$14.00","description":"Taxes","rate":"15%"}},"contact_details":{"first_name":"bill","last_name":"smith","email":"caleb.reynolds@moneris.com","phone":"4165551234"},"shipping_rates":[{"code":"codeO1","description":"Standard","date":"3 days","amount":"$200.00","txn_taxes":"$16.80","txn_total":"1202.80","default_rate":"false"},{"code":"codeO2","description":"Decline","date":"1 day","amount":"-$999.00","txn_taxes":"$0.04","txn_total":"5.00","default_rate":"true"},{"code":"codeO3","description":"Pick-up","date":"n\/a","amount":"Free","txn_taxes":"$14.00","txn_total":"1000.00","default_rate":"false"}]}
{"response" : {"success":"true","ticket":"1547580967l3Ikh0JHZgArYNopx1H5NceVyRdmP1"}}<br><Br>got a ticket: 1547580967l3Ikh0JHZgArYNopx1H5NceVyRdmP1

<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <META http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <META http-equiv="Pragma" content="no-cache" /><META http-equiv="Expires" content="0" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script  src="https://code.jquery.com/jquery-3.3.1.min.js"  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="  crossorigin="anonymous"></script>
    <script src="https://gatewaydev.moneris.com/chkt/js/chkt_v1.00.js"></script>
</head>

<body>
<br><br><br>
<input type="button" onClick="myCheckout.startCheckout('1547580967l3Ikh0JHZgArYNopx1H5NceVyRdmP1')" value="gotoCheckout">

<div id="monerisCheckout"></div>

</body>

<script>

    var myCheckout = new monerisCheckout();
    var res = {};


    myCheckout.setMode("dev");
    myCheckout.setCheckoutDiv("monerisCheckout");

    myCheckout.setCallback("address_change",myAddressChange);
    myCheckout.setCallback("cancel_transaction",myCancelTransaction);
    myCheckout.setCallback("payment_receipt",myPaymentReceipt);
    myCheckout.setCallback("payment_complete",myPaymentComplete);
    myCheckout.setCallback("error_event",myErrorEvent);
    myCheckout.setCallback("page_loaded",myPageLoad);

    myCheckout.logConfig();

    //myCheckout.startCheckout("qwerty12345");

    function myAddressChange(msg)
    {
        console.log("new address is: " + msg);
        // got an address change send new shipping and total.

        rates = {};
        rates["action"] = "set_shipping_rates";
        rates["data"] = {};

        rate = {};
        rate[0] = {};
        rate[0]["code"] = "rateM1";
        rate[0]["description"] = "Standard R";
        rate[0]["date"] = "4 days";
        rate[0]["amount"] = "Free";
        rate[0]["txn_taxes"] = "0.01";
        rate[0]["txn_total"] = "1.00";
        rate[0]["default_rate"] = "false";

        rate[1] = {};
        rate[1]["code"] = "rateM2";
        rate[1]["description"] = "Express R";
        rate[1]["date"] = "0.5 day";
        rate[1]["amount"] = "11.01";
        rate[1]["txn_taxes"] = "2.01";
        rate[1]["txn_total"] = "13.01";
        rate[1]["default_rate"] = "true";

        rate[2] = {};
        rate[2]["code"] = "rateM3";
        rate[2]["description"] = "Deliery by foot";
        rate[2]["date"] = "1 week";
        rate[2]["amount"] = "6.00";
        rate[2]["txn_taxes"] = "1.51";
        rate[2]["txn_total"] = "16.23";
        rate[2]["default_rate"] = "true";

        rates["data"] = rate;

        json_rate = JSON.stringify(rates)
        console.log(json_rate);

        myCheckout.setNewShippingRates(json_rate);
    }

    function myCancelTransaction(data)
    {
        console.log(data);
        myCheckout.closeCheckout();
    }

    function myPaymentComplete(data)
    {
        console.log("got payment complete");
        console.log(data);
        myCheckout.closeCheckout();

        res = JSON.parse(data);

        $('<form method="POST"><input type="hidden" name="get_response" value="true"><input type="hidden" name="ticket" value="' + res.ticket + '"></form>').appendTo('body').submit();

    }

    function myPaymentReceipt(data)
    {
        console.log("got payment Receipt");
        console.log(data);
    }
    function myErrorEvent()
    {
        alert("error");
        myCheckout.closeCheckout();
    }

    function myPageLoad(data)
    {
        console.log(data);
        var load = JSON.parse(data);
    }

    $(document).ready(function()
    {
        //myCheckout.startCheckout('1547580967l3Ikh0JHZgArYNopx1H5NceVyRdmP1')
    });

</script>


</html>

